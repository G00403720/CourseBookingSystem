services: 
  db: 
    image: postgres:17-alpine 
    env_file: .env.docker 
    volumes: 
      - postgres-data:/var/lib/postgresql/data 
    ports: 
      - "5433:5432" 
    healthcheck: 
      test: ["CMD-SHELL", "pg_isready -h 127.0.0.1 -p 5432 -U \"${POSTGRES_USER:-app}\" -d \"${POSTGRES_DB:-appdb}\""] 
      interval: 5s 
      retries: 10 
    restart: unless-stopped 

  user-service:
    build: ./user-service
    env_file: .env.docker 
    ports:
      - "8001:8000" 
    depends_on:
      - db
    environment:
      - APP_ENV=docker  
    restart: unless-stopped

  course-service:
    build: ./course-service
    env_file: .env.docker 
    ports:
      - "8002:8000" 
    depends_on:
      - db
      - user-service
    environment:
      - APP_ENV=docker 
    restart: unless-stopped

  booking-service:
    build: ./booking-service
    env_file: .env.docker 
    ports:
      - "8004:8000" 
    depends_on:
      - db
      - user-service
      - course-service
    environment:
      - APP_ENV=docker 
    restart: unless-stopped

  notification-service:
    build: ./notification-service
    env_file: .env.docker 
    ports:
      - "8005:8000" 
    depends_on:
      - db
      - user-service
      - course-service
      - booking-service
    environment:
      - APP_ENV=docker 
    restart: unless-stopped

volumes:
  postgres-data: {}
